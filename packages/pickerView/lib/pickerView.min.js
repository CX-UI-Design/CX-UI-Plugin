!function(){var o={extend:function(t){for(var e=1,s=arguments.length;e<s;e++)for(var n in arguments[e])arguments[e].hasOwnProperty(n)&&(t[n]=arguments[e][n]);return t},indexOf:function(t,e){for(var s=-1,n=0,i=t.length;n<i;n++)if(t[n]===e){s=n;break}return s},css:function(t,e){for(var s in e)t.style[s]=e[s]},addClass:function(t,e){var s=t.className.split(/\s+/);-1==o.indexOf(s,e)&&s.push(e),t.className=s.join(" ")},removeClass:function(t,e){var s=t.className.split(/\s+/),n=o.indexOf(s,e);-1!==n&&s.splice(n,1),t.className=s.join(" ")},hasClass:function(t,e){if(!t||!t.className)return!1;var s=t.className.split(/\s+/);return-1!=o.indexOf(s,e)},parents:function(t,e){if(!t)return null;var s=t.parentNode;return s===document?null:(this.hasClass(s,e)||(s=this.parents(s,e)),s)},isObject:function(t){return"[object Object]"==Object.prototype.toString.call(t)},isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)}};function l(t){for(var e in this.Opt={title:"标题",leftText:"取消",rightText:"确定",pickTouchSpeed:"0.3s",saveFn:function(t){}},t)t[e]&&(this.Opt[e]=t[e]);this._y_start="",this._y_move="",this._y_end="",this.top_start=0,this.isMove=!1,this.elem_wrap=null,this.elem_leftBtn=null,this.elem_rightBtn=null,this.elem_contents=null,this.elem_mask=null;var s=this.Opt.bindElem.getAttribute("selectcache");this.selectcache=s?s.split(","):[],this.selectArr=[],this.fleeIndex=null,this.init()}l.VERSION="1.0.0",l.defaultOpt={headerHeight:45,itemHeight:34},l.prototype={constructor:l,getItemTpl:function(t){for(var e="",s=0;s<t.length;s++)e+='<div class="content-item">'+t[s]+"</div>";return e},getItemsTpl:function(t){var e=this.selectcache[this.selectArr.length]?this.selectcache[this.selectArr.length]:0;this.fleeIndex=e,console.log(this.fleeIndex),this.selectArr.push(e);var s="",n=this.getItemTpl(t);return s+='<div index="'+(this.selectArr.length-1)+'" class="ns-pickerView-box__content"><div style="background-size:100% '+this.padding+'px;" class="content-mask"></div><div style="top:'+this.padding+'px;" class="content-indicator"></div><div style="padding:'+this.padding+"px 0;transform:translate3d(0,"+this.fleeIndex+'px,0)" fieldIndex="0" class="content-items">'+n+"</div></div>"},renderItems:function(t){var e="",s=t,n=o.isObject(t);n&&(s=Object.keys(t)),e+=this.getItemsTpl(s);var i=this.selectArr[this.selectArr.length-1];return n&&(e+=this.renderItems(t[s[i]])),e},getTpl:function(){var t='<div class="ns-pickerView-mask"></div><div class="ns-pickerView-box"><div class="ns-pickerView-box__header"><div class="ns-pickerView-box__header-btn left">'+this.Opt.leftText+'</div><div class="ns-pickerView-box__header-title">'+this.Opt.title+'</div><div class="ns-pickerView-box__header-btn right">'+this.Opt.rightText+'</div></div><div class="ns-pickerView-box__content-wrap">';return t+=this.renderItems(this.Opt.data),t+="</div></div>"},init:function(){var r=this,t=document.getElementsByTagName("body")[0],e=document.createElement("div");e.className="ns-pickerView",this.elem_wrap=e,this.padding=(.4*document.documentElement.clientHeight-l.defaultOpt.headerHeight-l.defaultOpt.itemHeight)/2,e.innerHTML=this.getTpl(),t.appendChild(e),this.elem_mask=this.elem_wrap.getElementsByClassName("ns-pickerView-mask")[0],this.elem_contents=this.elem_wrap.getElementsByClassName("ns-pickerView-box__content-wrap")[0],this.elem_leftBtn=this.elem_wrap.getElementsByClassName("left")[0],this.elem_rightBtn=this.elem_wrap.getElementsByClassName("right")[0],this.elem_contents.addEventListener("touchstart",function(t){r.moveObj=o.parents(t.target,"ns-pickerView-box__content").children[2],r.touchstart(t),t.stopPropagation()},!1),this.elem_contents.addEventListener("touchmove",function(t){r.touchmove(t),t.stopPropagation(),t.preventDefault()},!1),this.elem_contents.addEventListener("touchend",function(t){r.touchend(t),t.stopPropagation()},!1),this.elem_mask.addEventListener("touchend",function(t){r.closeComponent(),t.stopPropagation(),t.preventDefault()},!1),this.elem_leftBtn.addEventListener("touchend",function(t){r.closeComponent(),t.stopPropagation(),t.preventDefault()},!1),this.elem_rightBtn.addEventListener("touchend",function(t){for(var e=[],s=0;s<r.elem_contents.children.length;s++){var n=r.elem_contents.children[s].children[2],i=0<n.children.length?n.children[r.selectArr[s]].innerText:"";e.push(i)}r.Opt.rightBtnFn(e),r.closeComponent(),r.Opt.bindElem.setAttribute("selectcache",r.selectArr),t.stopPropagation(),t.preventDefault()},!1)},touchstart:function(t){this._y_start=t.touches[0].pageY,this.isMove=!1,this.top_start=parseInt(this.moveObj.style.transform.split(",")[1])},touchmove:function(t){this.isMove=!0,this._y_move=t.touches[0].pageY;var e=parseFloat(this._y_move)-parseFloat(this._y_start)+parseFloat(this.top_start);o.css(this.moveObj,{transform:"translate3d(0,"+e+"px,0)"}),this.top_end=e},touchend:function(t){if(this.isMove){this.isMove=!1;var e=this,s=l.defaultOpt.itemHeight,n=0<=this.top_end?1:-1,i=this.moveObj.parentNode.getAttribute("index"),r=Math.round(Math.abs(this.top_end)/s),a=n*(r*s);0<a?r=a=0:a<-(this.moveObj.children.length-1)*s&&(a=-(this.moveObj.children.length-1)*s,r=this.moveObj.children.length-1),this.selectArr[i]=r,this.moveObj.setAttribute("fieldIndex",r),this.moveObj.style.transition=this.Opt.pickTouchSpeed+" cubic-bezier(0,0,0.2,1.15)",o.css(e.moveObj,{transform:"translate3d(0,"+a+"px,0)"}),e.changeNext(i),e.moveObj.addEventListener("transitionend",function(t){e.moveObj.style.transition=""},!1),e.moveObj.addEventListener("webkitTransitionEnd",function(t){e.moveObj.style.transition=""},!1)}},changeNext:function(t){for(var e=this.Opt.data,s=[],n=0;n<this.selectArr.length;n++){var i=this.elem_contents.children[n].children[2];if(t<n)o.css(i,{transform:"translate3d(0,0,0)"}),this.selectArr[n]=0,s=o.isObject(e)?Object.keys(e):e,i.innerHTML=this.getItemTpl(s),e=e[s[0]];else e=e[i.children[this.selectArr[n]].innerText]}},closeComponent:function(){document.getElementsByTagName("body")[0].removeChild(this.elem_wrap)}},window.PickerView=l}();